- 服务注册于发现基本模型
	- IP 直连
	- 使用域名
	- 注册中心
	- 服务自省
	- 借助微服务网关的服务注册与发现
- 注册中心机制
	- 服务启动过程
	- 服务发现过程
- 在 gRPC 中使用注册中心
	- gRPC 中接入服务注册与发现
	- 不同微服务框架的接入方案
- 注册中心选型
	- CAP 基本理论
	- 注册中心与 CAP
- 服务注册与发现的高可用
	- 注册中心崩溃
	- 服务端与注册中心连不上
	- 客户端与注册中心连不上
	- 客户端与服务端连不上

![[Snipaste/Pasted image 20240308150410.png]]

注册中心机制

1. 服务端注册
2. 客户端第一次先查询注册中心，然后缓存可用节点
3. 负责中心在服务节点发生变动的时候 ，主动通知一下客户端

注册中心在大规模集群下容易成为瓶颈

![[Snipaste/Pasted image 20240308150737.png]]

1. 元数据的概念  
![[Snipaste/Pasted image 20240308150901.png]]

2. 服务网关位置，通过域名得到
3. 知道真是服务器位置，服务注册与发现过程，借助注册中心或者 DNS

## 注册中心机制

![[Snipaste/Pasted image 20240308151134.png]]

1. 域名 + 端口 | IP + 端口连接注册中心

![[Snipaste/Pasted image 20240308151255.png]]

1. 定位信息，IP + 端口 关键
2. 其他信息：比如分组功能，一般是用来搞服务治理的

![[Snipaste/Pasted image 20240308151536.png]]  

1. 服务器主动  
2. 注册中心主动  
3. 心跳失败、判定服务节点崩溃，通知客户端不要使用这个节点

心跳机制

![[Snipaste/Pasted image 20240308151813.png]]

1. 心跳时间间隔
2. 如何判定连不上，一次心跳还是多次心跳

![[Snipaste/Pasted image 20240308152404.png]]

1. 双向心跳、用的很少

![[Snipaste/Pasted image 20240308152435.png]]

优雅的服务下线

![[Snipaste/Pasted image 20240308152538.png]]

1. 通知注册中心
2. 服务节点拒绝新请求，读取一般请求，读完之后直接拒绝，不会交给后端业务代码
3. 等到正在处理的请求结束，定时任务等待结束
4. 处理已经接收的请求完毕，服务端结束运行
5. 超时控制退出，业务时间过长，超过时间限制，直接退出

![[Snipaste/Pasted image 20240308152950.png]]

1. 服务发现时机
	1. 客户端启动的时候
	2. 第一次调用某个服务的时候，执行服务发现  
2. 注册中心和客户端也保持心跳

## 面试要点

![[Snipaste/Pasted image 20240308153148.png]]

1. 服务注册与发现有哪些组件

## 在 gRPC 中使用注册中心 (接入服务注册与发现)
