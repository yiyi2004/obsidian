1. JWT 是如何实现的，长短 token 的设计
2. 短信验证码登录
3. 微信登录如何实现
4. 如何保证登录接口的安全性: 限流 + 短信条数限制

短信验证码服务：

1. 短信验证码服务的流程

互动服务组件：

1. 如何实现的
2. 一致性如何保证

文章管理：

1. 文章的发布是如何实现的

热榜服务：

1. 热榜服务是如何实现的

搜索服务：

1. 如何实现

可观测性：

1. 观测了哪些指标

其他问题：

1. 服务是怎么拆分的

## JWT 问题

### JWT 是如何生成的

JWT token 的生成过程通常包括以下步骤：

1. **选择加密算法和密钥**：
   - 首先，选择一个加密算法，比如 HMAC SHA256 或者 RSA。
   - 如果选择对称加密算法，需要生成一个密钥。如果选择非对称加密算法，需要生成一对公钥和私钥。

2. **创建头部（Header）**：
   - 创建一个 JSON 对象，包含了两部分信息：令牌的类型（即 JWT）和所使用的签名算法。
   - 使用 Base64 URL 编码将头部转换为字符串。

3. **创建载荷（Payload）**：
   - 创建一个 JSON 对象，包含了一系列声明，提供了关于用户和其他实体的信息。
   - 包括标准的声明（注册声明），比如“iss”（Issuer，发行者）、“exp”（Expiration Time，过期时间）和“sub”（Subject，主题），以及自定义的声明（公共声明和私有声明）。
   - 使用 Base64 URL 编码将载荷转换为字符串。

4. **生成签名（Signature）**：
   - 将编码后的头部和载荷以及密钥作为输入，使用所选择的加密算法生成签名。
   - 对于对称加密算法，使用密钥直接进行签名；对于非对称加密算法，使用私钥进行签名。

5. **拼接 JWT token**：
   - 将编码后的头部、载荷和签名以点（.）作为分隔符，拼接在一起，形成最终的 JWT token。

6. **返回 JWT token**：
   - 将生成的 JWT token 发送给客户端，可以存储在本地，比如 localStorage 或者 sessionStorage 中，用于后续的请求鉴权。

整个过程中，需要注意：

- 在创建载荷时，需要谨慎选择声明，并确保包含必要的标准声明和自定义声明。
- 在生成签名时，需要使用安全的密钥，并确保密钥的保密性。
- 客户端和服务器端需要约定好使用的加密算法和密钥，以便正确验证 JWT token 的真实性和完整性。

### JWT 和 Cookie 和 Session 的区别

JSON Web Tokens (JWT)，cookie 和 session 是用于在 Web 开发中进行身份验证和状态管理的常见工具，它们之间有一些区别：

1. **JWT (JSON Web Tokens)**:
   - JWT 是一种用于安全地在两个实体之间传递信息的开放标准 (RFC 7519)。它基于 JSON 格式并被签名，通常用于在客户端和服务器之间安全地传递信息。
   - JWT 是无状态的，即服务器不需要在自己的内存中保存关于用户的会话信息。这使得 JWT 可以在分布式系统中很好地扩展，并且不需要额外的存储开销。
   - JWT 由三部分组成：头部 (Header)，载荷 (Payload) 和签名 (Signature)。头部包含了令牌的类型和所使用的签名算法；载荷包含了令牌的声明，比如用户 ID、权限等信息；签名用于验证令牌的真实性。
   - JWT 通常存储在客户端的 localStorage 或者 sessionStorage 中，或者作为 HTTP 请求的 Authorization 头的一部分。
2. **Cookie**:
   - Cookie 是由服务器发送到客户端并存储在客户端的小型数据片段，它通常用于在客户端和服务器之间维护会话状态。
   - Cookie 通常包含了与用户相关的身份验证和其他信息，并在每次请求时都会被自动发送到服务器。
   - Cookie 可以设置过期时间，在客户端存储的持久性信息通常是基于 Cookie 的。
3. **Session**:
   - Session 是服务器上的一种数据结构，用于存储关于用户会话的信息。
   - 当用户通过身份验证时，服务器会创建一个会话，并分配一个唯一的会话 ID，该 ID 通常存储在一个名为 session ID 的 cookie 中。
   - 在服务器端，会话数据通常存储在内存、数据库或者其他持久性存储中。
   - Session 比 Cookie 更安全，因为用户无法直接访问会话数据，但需要服务器端进行存储和管理。

主要区别在于数据的存储位置和安全性：

- JWT 数据存储在客户端，无需服务器存储，但需要考虑 XSS 和 CSRF 攻击。
- Cookie 和 Session 数据存储在服务器端，提供了更高的安全性，但需要服务器端进行存储和管理，可能会增加服务器负担。

### JWT 实现鉴权

JWT（JSON Web Tokens）是一种用于在两个实体之间安全传输信息的开放标准（RFC 7519）。它由三部分组成：头部（Header）、载荷（Payload）和签名（Signature）。

1. **头部（Header）**：头部通常包含了两部分信息，令牌的类型（即 JWT）和所使用的签名算法（比如 HMAC SHA256 或 RSA）。头部是一个 JSON 对象，被 Base64 URL 编码后放置在 JWT 的第一部分。
2. **载荷（Payload）**：载荷包含了称为“声明”的信息，它是一组键值对，提供了关于用户和其他实体的信息。有三种类型的声明：
   - **注册声明（Registered Claims）**：这些是预定义的声明，包括标准的声明，例如“iss”（Issuer，发行者）、“exp”（Expiration Time，过期时间）和“sub”（Subject，主题）。
   - **公共声明（Public Claims）**：这些是自定义的声明，可以根据需要添加到载荷中，但要避免与注册声明冲突。
   - **私有声明（Private Claims）**：这些是自定义的声明，它们被定义和使用在 JWT 的实体之间，且不注册或公开标准的声明，通常是应用程序特定的。

载荷是一个 JSON 对象，也被 Base64 URL 编码后放置在 JWT 的第二部分。

1. **签名（Signature）**：签名是对头部和载荷进行签名的过程，使用了头部中指定的算法和密钥。签名的目的是确保 JWT 在传输过程中没有被篡改。

JWT 的工作流程如下：

- 用户进行身份认证后，服务器生成一个 JWT，包含了用户的相关信息，例如用户 ID 和权限。
- 服务器将 JWT 发送给客户端，客户端通常将其存储在本地，比如 localStorage 或者 sessionStorage 中。
- 客户端在后续的请求中携带 JWT，通常放置在 HTTP 请求的 Authorization 头中。
- 服务器接收到 JWT 后，对其进行验证，包括检查签名是否有效、载荷中的声明是否符合预期，并且检查令牌是否已过期。
- 如果 JWT 通过验证，服务器根据载荷中的信息对请求进行授权，完成相应的操作。

JWT 实现了鉴权的原理在于：

- JWT 本身包含了用户的身份信息，服务器无需在自己的存储中保存会话信息，使得服务器变得无状态。
- 通过数字签名，服务器可以验证 JWT 的真实性和完整性，确保令牌在传输过程中没有被篡改。
- 载荷中的声明提供了关于用户的信息，服务器可以根据这些信息对请求进行授权。
