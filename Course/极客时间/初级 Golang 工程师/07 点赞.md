1. 需求分析
2. 阅读数功能设计与实现
3. 点赞功能的设计与实现
4. 收藏功能的设计与实现
5. Kafka 入门
6. 用 Kafka 改造阅读计数实现
7. Kafka 面试中的重难点

## 需求分析

1. 基本功能——如何实现一个功能。
2. 是否通用

gorm expr 操作

![image-20240306144503735](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306144503735.png)

创建联合的唯一索引

![image-20240306144551121](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306144551121.png)

事实上，你只需要考虑情况一，因为 Redis 有一个
HIncrBy 命令，它能够保证，如果 read_cnt 不存在，
就先设置为 0，而后自增 1。

![image-20240306144756475](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306144756475.png)

![image-20240306144857564](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306144857564.png)

软删除

update status 替代直接插入删除，更新某个字段的

硬删除整个删除、整个插入的性能要比这里只是更新
一个字段慢。

![image-20240306145931587](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306145931587.png)

- 插入点赞记录
- 增加文章 Like 的数量

查询接口实现

![image-20240306150520386](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306150520386.png)

不需要解决并发问题

![image-20240306150950883](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306150950883.png)

点赞功能实现小结

![image-20240306152238942](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306152238942.png)

引入 Redis 来提高计数类业务的性能

1. Redis 直接维护住总数
2. 排查业务，看能不能使用第二种优化业务的性能
3. SELECT COUNT 优化 SQL 命中索引

SQL 查询优化，我是真的很信任你的。

![image-20240306152708287](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306152708287.png)

基础概念

1. producer
2. consumer
3. broker 消息服务器
4. topic 和 partition
5. 消费者组与消费者

一个 topic 是一个业务

主分区与 broker，干好自己的事情。

![image-20240306153435163](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306153435163.png)

1. 轮询
2. 随机
3. 哈希

**如果要做到业务有序，就需要保证业务的消息都丢**
**到同一个分区里面果要做到全局有序，就只能有一个分区。**

上面应该是保证有序的核心

![image-20240306160207994](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306160207994.png)

- 消费者组、消费者、分区之间的关系。

![image-20240306160338855](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306160338855.png)

- 由此衍生出消息积压问题，如何解决消息积压的问题

kafka 早期版本需要一个 zookeeper 现在不需要了捏

Raft 实现，分布式的理论需要补充一下。

客户端的选择：

![image-20240306160742676](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306160742676.png)

- 分布式的项目选择。封装成 shell 脚本。

sarama tools

![image-20240306161207023](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306161207023.png)

- 发送消息入门

![image-20240306161328093](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306161328093.png)

- sarama 分区选择

![image-20240306161434562](C:\Users\zhang\AppData\Roaming\Typora\typora-user-images\image-20240306161434562.png)

- 异步发送例子

社区比较好的方案，得到一些面试的经验。相信自己是可以的。

