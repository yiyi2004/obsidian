# 写作结构
1. 分析一两个 APT 攻击样例 —— 分析需要从哪些角度出发，检测哪些特征。
	1. APT 攻击的样例去哪里找捏 1~2，能力之外，要和老师商量一下。
2. 从底层向上说，yara
3. 和 solr(更偏向于文档的检索) 的差异，与mysql(传统数据的存储和查询)的差异，选择的原因，对比各种产品的优劣势 ELK，大数据领域 3~4
4. ES 展开说说、整合各种IDS 的能力，产生的告警样例 2~3

我感觉这样可能真的写不够欸。

# 正文
我们通过将 HIDS 和 NIDS 产生的告警存储在 Elasticsearch (以下简称 ES) 中，并利用 ES 的 RESTful API 获取告警数据并进行关联，从而梳理出一条或多条攻击链。具体而言，IDS 产生的告警会被 Filebeat 收集并转换成 JSON 格式的告警，然后存储在 ES 中。因此，本节将详细介绍 HIDS、NIDS 和 ES 的相关细节。

可以写一点主机威胁检测的**综述**，然后甩出我们的方法。
- 这样做的优势和好处是什么。
- elasticsearch + kibana 的技术 + filebeat + 监控引擎
- 主机告警检测的原理
- 威胁检测的附加功能
- 开放性

# IDS
## HIDS
对于 HIDS 的选择，我们主要调研了两款开源的 HIDS，Wazuh 和 OSSEC。Wazuh和OSSEC都是基于开源技术的安全监控解决方案，由于Wazuh是OSSEC的一个分支，两者在很多方面有相似之处。具有如下的有点：
1. 开源和免费：Wazuh和OSSEC都是基于开源技术的免费软件，可以大大降低企业的安全监控成本。
2. 多功能和易于部署：Wazuh和OSSEC都提供了丰富的安全监控功能和可配置的告警策略，同时也非常易于部署和管理。用户可以快速开始监控并定制自己的安全策略。
3. 集中式管理和可扩展性：Wazuh和OSSEC都提供了一个集中式的管理控制台和API，可以管理多个代理、集成多种数据源和安全工具，并且可以方便地进行扩展。
4. 支持多种平台和操作系统：Wazuh和OSSEC都支持多种操作系统和平台，如Windows、Linux、MacOS、Docker 等，可以满足不同组织的需求。
Wazuh是OSSEC的一个分支，比OSSEC增加了更多的功能和扩展性，但同时也增加了一些复杂度。从架构的角度来说，Wazuh 的设计更为完善，IDS 的架构一般由 Agent、管理端、规则分析中心和报表中心组成，Wazuh 包含这四个部分：
- Wazuh-Agent：Agent安装于受监控主机中，Agent客户端支持windows、Linux、Mac OS、HP-UX 等常见操作系统。Agent主要负责向Server端提供检测信息、对攻击作出响应。注意：Agent不负责对数据进行分析。
- Wazuh-Server：Server端接收到来自Agent的信息后，会使用它的`decoders`和`rules`对信息进行处理。Server端主要负责对检测信息进行分析（提取有用的信息、匹配漏洞信息、进行攻击研判等）然后使用 Filebeat 将信息存入ElasticSearch数据库中。一般来说，一台Server可以处理近千台Agent。
- Elastic Stack：这部分我们主要用了 Elasticsearch 进行数据整合

除此之外，我们的项目还整合了一个恶意软件检测工具 yara，Yara是一种基于规则的轻量级工具，用于在二进制文件和其他文件中进行特征匹配。它可以帮助安全专业人员和研究人员快速检测恶意软件、病毒和其他威胁。

Yara规则由三个部分组成：规则头、条件和动作。规则头定义了规则的名称、元数据和其他信息。条件描述了要匹配的模式，可以是字符串、哈希值、文件大小等等。动作则是在匹配到规则时执行的操作，如记录日志、发送警报等。

Yara可以用于分析多种类型的文件，包括PE文件、OLE文件、PDF文件、Office文档和压缩文件等。使用Yara可以快速创建自定义规则，以便对新的恶意软件进行识别和分析。此外，Yara还可以与其他安全工具（如反病毒软件、入侵检测系统等）集成，提高安全性和威胁检测效率。总之，Yara是一种强大的工具，可以帮助安全专业人员快速识别恶意软件和其他威胁，提高网络安全性和响应能力。

Yara 具有以下优点：
1. 灵活性：Yara允许用户在规则中使用各种条件，包括字符串、哈希值、文件大小、文件类型等，从而提高了规则的适用范围和准确性。此外，Yara还支持逻辑运算符和正则表达式，使得规则的创建更加灵活和方便。
2. 易用性：Yara具有直观的命令行界面和易于使用的API，使得用户可以轻松地创建、编辑和执行规则。此外，Yara还提供了丰富的文档和社区支持，帮助用户快速入门和解决问题。
3. 可扩展性：Yara可以与其他工具和系统集成，如反病毒软件、入侵检测系统等，从而提高了威胁检测的效率和准确性。此外，Yara还支持插件机制，可以根据需要添加自定义插件，扩展其功能和适用范围。
4. 开放性：Yara是一个开源工具，用户可以自由地使用、修改和共享规则和代码，从而推动整个安全社区的发展和进步。

综上所述，Yara是一种功能强大、灵活性高、易用性好、可扩展性强、开放性好的安全工具，可以帮助安全专业人员快速识别和响应各种威胁，保护网络和系统的安全。

## NIDS

Suricata最初是由Open Information Security Foundation (OISF)发起并开发的，OISF是一个非营利性组织，致力于开发和维护开源的网络安全工具和技术。

Suricata不仅支持基于规则的检测，还支持协议解析和流量分析。它使用高级协议解析引擎（APE），能够解析TCP、UDP、ICMP等协议，并且支持检测和提取各种应用层协议，如HTTP、SMTP、POP3、FTP、DNS、TLS等。此外，Suricata还支持基于流量和行为的检测，可以检测和识别潜在的零日攻击、恶意软件和高级持久性威胁(APT)。

Suricata的规则语言非常强大，可以使用多种匹配规则，如正则表达式、IP地址、域名、端口等，也支持多种检测方式，如内容匹配、基于协议的检测、基于流量的检测等。此外，Suricata的规则还支持嵌套、引用和条件语句，可以实现更复杂的检测逻辑。

Suricata还具有可扩展性和可定制性，可以通过模块化插件机制扩展其功能，并支持自定义解码器、协议解析器和输出插件等。此外，Suricata还可以与其他工具集成，如ELK Stack、Zeek等，可以为企业提供更全面的安全解决方案。

除了具备网络入侵检测功能外，Suricata还具有以下特点：
1. 多线程处理：Suricata采用多线程处理技术，能够同时处理多个网络流量，提高检测性能和效率。
2. 跨平台支持：Suricata可以运行在多种操作系统上，包括Linux、Windows、FreeBSD等，便于企业在不同平台上部署和使用。
3. 日志输出：Suricata可以输出多种格式的日志，如JSON、EVE、FAST、LOG等，方便企业进行后续的安全分析和调查。
4. 自适应流量控制：Suricata支持根据流量负载自适应调整检测性能，避免因流量过大导致检测性能下降。
5. 支持IPv6：Suricata支持IPv6协议，并且能够对IPv6网络流量进行检测和分析，能够更好地适应未来网络的发展。
6. 支持多种协议：Suricata支持多种协议的检测和分析，如HTTP、SMTP、POP3、FTP、DNS、TLS等，能够全面覆盖企业网络的安全需求。
7. 支持多种文件格式：Suricata还支持多种文件格式的检测和分析，如PE、PDF、Office文档、压缩文件等，能够识别和拦截恶意文件。
    

总之，Suricata是一款功能丰富、可定制、高性能的网络安全工具，可以为企业提供全面的网络入侵检测和防御能力，帮助企业及时发现和拦截各种网络威胁，保障企业的信息安全。


对比 Elasticsearch、Solr 和 MySQL 的优缺点

以下是 Elasticsearch、Solr 和 MySQL 的优缺点对比：

1.  Elasticsearch优点：
    
    -   分布式架构：Elasticsearch基于分布式架构，能够实现数据的高可用和水平扩展。
    -   高速查询：Elasticsearch能够在海量数据中快速查询，支持全文检索和聚合操作。
    -   实时性能优秀：Elasticsearch支持实时搜索和数据更新，能够实时反映数据的变化。
    -   强大的API支持：Elasticsearch提供了丰富的API支持，便于开发者进行定制化开发。
    
    缺点：
    
    -   存储和内存开销较大：Elasticsearch采用倒排索引存储数据，需要较大的磁盘空间和内存开销。
    -   不支持事务：Elasticsearch不支持事务处理，不适用于需要高度一致性的业务场景。
    -   数据安全性不足：Elasticsearch默认不提供数据加密和身份验证等安全机制。
2.  Solr优点：
    
    -   高速查询：Solr支持分布式查询和多种查询语法，能够快速检索海量数据。
    -   丰富的文档处理能力：Solr能够对各种文档格式进行索引和检索，如HTML、XML、PDF、Word等。
    -   可扩展性好：Solr采用分布式架构，能够实现数据的水平扩展。
    -   易于集成：Solr提供了丰富的API和插件支持，便于开发者进行集成和定制化开发。
    
    缺点：
    
    -   没有实时性支持：Solr不支持实时更新和查询，需要手动提交索引才能生效。
    -   对存储空间和内存开销较大：Solr采用基于Lucene的倒排索引存储数据，需要较大的存储空间和内存开销。
    -   复杂度较高：Solr相对于其他搜索引擎，配置和使用较为复杂。
3.  MySQL优点：
    
    -   支持事务处理：MySQL支持事务处理，能够保证数据的一致性和完整性。
    -   成熟稳定：MySQL是一款经过长期验证的数据库系统，稳定性和可靠性较高。
    -   社区活跃：MySQL有一个庞大的社区，提供丰富的技术支持和解决方案。
    -   兼容性好：MySQL支持多种操作系统和编程语言，能够方便地集成到各种应用系统中。
    
    缺点：
    
    - 性能有限：MySQL对海量数据的查询和分析能力有限。
    -   扩展性有限：MySQL

![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2730%27%20height=%2730%27/%3e)![爱吃橘子](https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAGNmyxYpCAVD42LhXYbVorBG_oGJH-4ZA9cQJTPPW3MG%3Ds96-c&w=64&q=75)

继续

4.  MySQL缺点：
    -   不适合海量数据：MySQL对于海量数据的查询和分析能力有限，不适合大数据场景。
    -   难以扩展：MySQL采用主从架构或者分片技术进行扩展，不如分布式数据库具有良好的扩展性。
    -   不支持全文检索：MySQL不支持全文检索，需要通过第三方插件或者其他技术进行扩展。
    -   数据安全性不足：MySQL默认提供较少的数据加密和身份验证等安全机制。

在实际应用中，Elasticsearch和Solr更适合用于海量数据的全文检索和实时查询，而MySQL则更适合用于关系型数据的存储和事务处理。需要根据具体的业务需求和数据特点选择合适的技术方案。

![](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2730%27%20height=%2730%27/%3e)![爱吃橘子](https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAGNmyxYpCAVD42LhXYbVorBG_oGJH-4ZA9cQJTPPW3MG%3Ds96-c&w=64&q=75)

介绍下 Elasticsearch 和 Solr

Elasticsearch和Solr都是基于Lucene的开源搜索引擎，用于实现全文检索、日志分析、数据分析等场景，具有以下特点：

1.  Elasticsearch
    -   基于分布式架构，支持水平扩展，能够处理PB级别的数据。
    -   支持实时搜索，能够在毫秒级别内响应用户查询请求。
    -   支持多种数据类型的全文检索，包括文本、数字、日期、地理位置等。
    -   支持多种查询方式，包括全文检索、精确查询、范围查询、布尔查询等。
    -   提供RESTful API，易于集成和使用。
    -   具有强大的聚合分析功能，能够对数据进行统计、分组、排序等操作。
    -   提供可视化工具Kibana，用于展示和分析数据。
2.  Solr
    -   基于分布式架构，支持水平扩展，能够处理TB级别的数据。
    -   支持实时搜索，能够在毫秒级别内响应用户查询请求。
    -   支持多种数据类型的全文检索，包括文本、数字、日期、地理位置等。
    -   提供多种查询方式，包括全文检索、精确查询、范围查询、布尔查询等。
    -   提供RESTful API和JDBC接口，易于集成和使用。
    -   具有丰富的插件和扩展功能，支持数据同步、数据导入导出、数据清洗等操作。
    -   提供可视化工具Banana和Solr Dashboard，用于展示和分析数据。

Elasticsearch和Solr的使用场景类似，但在具体的选择上需要考虑数据规模、数据结构、查询需求、安全性等因素。

Regenerate response

# 对比 es、solr 和 mysql

## ChatGPT

Elasticsearch、Solr和MySQL都是常见的数据存储和搜索工具，它们各有特点和适用场景。
1. 数据存储方式：Elasticsearch和Solr都是搜索引擎，主要用于存储和搜索文本数据。它们支持全文搜索、模糊匹配和语义分析等功能，并且通常用于处理非结构化数据和日志数据。MySQL是关系型数据库，主要用于存储结构化数据，如用户信息、订单信息等。
2. 查询语言：Elasticsearch和Solr都有自己的查询语言，用于构建复杂的搜索查询和过滤条件。MySQL使用SQL语言，可以处理更广泛的查询场景，如聚合、分组、联表查询等。
3. 数据复制和分布式：Elasticsearch和Solr都天生支持数据复制和分布式架构，可以将数据和搜索请求分发到多个节点上，并提供自动分片和负载均衡功能。MySQL也支持数据复制和主从复制等分布式架构，但需要手动配置和管理。
4. 性能和扩展性：Elasticsearch和Solr都是基于Lucene的搜索引擎，具有快速的搜索和索引性能，并且可以水平扩展，适合处理大量的非结构化数据。MySQL也可以处理大量数据，但通常需要更多的硬件资源和优化技巧。

综上所述，Elasticsearch 和 Solr 适用于需要处理非结构化数据和文本搜索的场景，如日志分析、全文搜索、安全威胁检测等；而MySQL适用于需要处理结构化数据和复杂查询的场景，如电子商务、金融、社交网络等。当然，实际的选择取决于具体的需求和使用场景。在某些情况下，可能需要将这些工具结合使用，以获得更好的性能和功能。

Elasticsearch、Solr和MySQL都是常见的数据存储和搜索工具，它们各有特点和适用场景。
1. 数据存储方式：Elasticsearch和Solr都是搜索引擎，主要用于存储和搜索文本数据。它们支持全文搜索、模糊匹配和语义分析等功能，并且通常用于处理非结构化数据和日志数据。MySQL是关系型数据库，主要用于存储结构化数据，如用户信息、订单信息等。
2. 查询语言：Elasticsearch和Solr都有自己的查询语言，用于构建复杂的搜索查询和过滤条件。MySQL使用SQL语言，可以处理更广泛的查询场景，如聚合、分组、联表查询等。
3. 数据复制和分布式：Elasticsearch和Solr都天生支持数据复制和分布式架构，可以将数据和搜索请求分发到多个节点上，并提供自动分片和负载均衡功能。MySQL也支持数据复制和主从复制等分布式架构，但需要手动配置和管理。
4. 性能和扩展性：Elasticsearch和Solr都是基于Lucene的搜索引擎，具有快速的搜索和索引性能，并且可以水平扩展，适合处理大量的非结构化数据。MySQL也可以处理大量数据，但通常需要更多的硬件资源和优化技巧。

综上所述，Elasticsearch和Solr适用于需要处理非结构化数据和文本搜索的场景，如日志分析、全文搜索、安全威胁检测等；而MySQL适用于需要处理结构化数据和复杂查询的场景，如电子商务、金融、社交网络等。当然，实际的选择取决于具体的需求和使用场景。在某些情况下，可能需要将这些工具结合使用，以获得更好的性能和功能。

### 对比 ES、Solr 和 MySQL 的优缺点
以下是 Elasticsearch、Solr 和 MySQL 的优缺点对比：

1. Elasticsearch优点：
    - 分布式架构：Elasticsearch基于分布式架构，能够实现数据的高可用和水平扩展。
    - 高速查询：Elasticsearch能够在海量数据中快速查询，支持全文检索和聚合操作。
    - 实时性能优秀：Elasticsearch支持实时搜索和数据更新，能够实时反映数据的变化。
    - 强大的API支持：Elasticsearch提供了丰富的API支持，便于开发者进行定制化开发。
    缺点：
    - 存储和内存开销较大：Elasticsearch采用倒排索引存储数据，需要较大的磁盘空间和内存开销。
    - 不支持事务：Elasticsearch不支持事务处理，不适用于需要高度一致性的业务场景。
    - 数据安全性不足：Elasticsearch默认不提供数据加密和身份验证等安全机制。
2. Solr优点：
    - 高速查询：Solr支持分布式查询和多种查询语法，能够快速检索海量数据。
    - 丰富的文档处理能力：Solr能够对各种文档格式进行索引和检索，如HTML、XML、PDF、Word等。
    - 可扩展性好：Solr采用分布式架构，能够实现数据的水平扩展。
    - 易于集成：Solr提供了丰富的API和插件支持，便于开发者进行集成和定制化开发。
    缺点：
    - 没有实时性支持：Solr不支持实时更新和查询，需要手动提交索引才能生效。
    - 对存储空间和内存开销较大：Solr采用基于Lucene的倒排索引存储数据，需要较大的存储空间和内存开销。
    - 复杂度较高：Solr相对于其他搜索引擎，配置和使用较为复杂。
3.  MySQL优点：
    -   支持事务处理：MySQL支持事务处理，能够保证数据的一致性和完整性。
    -   成熟稳定：MySQL是一款经过长期验证的数据库系统，稳定性和可靠性较高。
    -   社区活跃：MySQL有一个庞大的社区，提供丰富的技术支持和解决方案。
    -   兼容性好：MySQL支持多种操作系统和编程语言，能够方便地集成到各种应用系统中。
    缺点：
    - 不适合海量数据：MySQL对于海量数据的查询和分析能力有限，不适合大数据场景。
    - 难以扩展：MySQL采用主从架构或者分片技术进行扩展，不如分布式数据库具有良好的扩展性。
    - 不支持全文检索：MySQL不支持全文检索，需要通过第三方插件或者其他技术进行扩展。
    - 数据安全性不足：MySQL默认提供较少的数据加密和身份验证等安全机制。

在实际应用中，Elasticsearch和Solr更适合用于海量数据的全文检索和实时查询，而MySQL则更适合用于关系型数据的存储和事务处理。需要根据具体的业务需求和数据特点选择合适的技术方案。

在实际的应用中，我们采用 Elasticsearch，因为我们更多的会使用 ES 进行查询分析，而ES相对 Solr 更擅长这件事情。

因为各种告警的格式通常来说是不同的，比如在我们架构中使用的基于 OSSEC 的 Wazuh 和 Suricata，他们的告警结构是不同的。这也是我们选择 ES 的重要原因之一，因为 Wazuh 和 Suricata 同样提供了将告警数据存储到 MySQL 等关系型数据库的方法。

# 多源异构的威胁表示
我们系统中接入了两种IDS，一个 HIDS Wazuh，另一个是 NIDS Suricata。这两种 IDS 本身就提供将告警存储为 JSON 格式的接口，通过 IDS 的接口，将告警转换为 JSON格式，并将其存储在 ES 中，如下所示：



# 数据存储设计


# Reference
- [山楂园 (jus4fun.xyz)](https://blog.jus4fun.xyz/article/101/)
- [wazuh 服务端源码分析 - 掘金 (juejin.cn)](https://juejin.cn/post/7077885405785227300)
- [Yara是什么 - 简书 (jianshu.com)](https://www.jianshu.com/p/831bc3f6d759)
- [(117条消息) 最后防线：三款开源HIDS应用对比评估_debugeeker的博客-CSDN博客](https://blog.csdn.net/xuzhina/article/details/115773698)
- [suricata学习笔记1--初步认识 - Rabbit_Dale - 博客园 (cnblogs.com)](https://www.cnblogs.com/Anker/p/5989842.html)
- [网络入侵检测系统之Suricata(一)--概览 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/339502825)
- [suricata简介-java面试题网 (wityx.com)](http://www.wityx.com/post/13201_1_1.html)
- [Elasticsearch vs Solr 搜索引擎对比和选型 - IT高薪猎头 - 博客园 (cnblogs.com)](https://www.cnblogs.com/gezifeiyang/p/10999238.html)
- [MySQL不香吗，为啥还要Elasticsearch？-51CTO.COM](https://www.51cto.com/article/656071.html)
- [代码在线高亮工具 | 将高亮美化的代码一键粘贴到 Word 或 OneNote 中 (highlightcode.com)](https://highlightcode.com/)
