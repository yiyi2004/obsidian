# 什么是服务树

- 树层级结构的服务资源管理系统

## 服务树的核心功能

- 资源管理
  - 资源分类
    - 机器
    - 存储
    - db
    - cache
    - 网络设备
    - 域名
    - 负载均衡器
  - 资源管理
    - 资源meta data
      - uid
      - cloud_provider
      - 规格 8c16g
      - ip name
      - region vpc idc
      - 分公共的和独特的
    - 资源状态
- 服务层级管理
- 服务和资源的关系管理
- 统计功能
- 依托服务树的附属功能 ?
  - 授权
  - 批量操作
  - cicd
  - 监控

# 服务树架构图

![.png](https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/908/1637741194000/19a58ec1818e411686526e2cd5ff7180.png)

# 01 树级结构维护模式

## 方法一：用户页面上维护结构

> 新增

- a.b.c 逐级查询，没有就新增，有就挂载

> 删除

- a.b.c 逐级查询，如果还有叶子节点，不允许删除。先删除叶子节点

> 查询

- 根据g查询 所有p的列表 node=g  query_type=1
- 根据g查询 所有g.p.a的列表 node=g   query_type=2
- 根据g.p查询 所有g.p.a的列表  node=g.p  query_type=3

> 变更

- 暂时不支持，可以通过删除+新增实现

## 方法二：基于资源的标签自动创建

- ticker扫 资源表，获取g.p.a标签
- 然后调删除增删接口即可

# 02 资源和树如何绑定

- 都是体现在资源的g.p.a标签上

## 方法一：用户手动维护

> 绑定 比如 1,2,3台机器 绑定到 inf.monitor.kafka

- 就是 修改1-3机器上的g.p.a标签为 inf.monitor.kafka

> 解绑 同理就是删除指定资源的 g.p.a标签

## 方法二：公有云资源打标签直接同步

# 索引模块

- 倒排

# 资源发现的逻辑

## agent采集上报

## 公有云同步