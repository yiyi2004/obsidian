## Domain

```go
// FollowRelation 关注数据
type FollowRelation struct {
	// 被关注的人
	Followee int64
	// 关注的人
	Follower int64
	// 根据你的业务需要，你可以在这里加字段
	// 比如说备注啊，标签啊之类的
	// Note string
}

type FollowStatics struct {
	// 被多少人关注
	Followers int64
	// 自己关注了多少人
	Followees int64
}
```

1. ee 是我关注的人
2. er 是我

## Repository

### Cache

- 仅仅统计某一个用户的关注和非关注的人数

### Dao

- Relation 关系
- 仅仅记录 Relation，统计数量通过 count 实现，然后记录在 Redis 里面

### Total

- 查询接口，快慢路径

## Redis Pipeline

#基础知识

- 简单来说，减少网络往返次数，提高 Redis 效率。

Redis pipeline 是一种通过减少网络往返次数（round-trip time, RTT）来提高数据库操作效率的技术。在没有使用 pipeline 的情况下，客户端发送一个命令到服务器，然后等待服务器响应，之后再发送下一个命令。每个命令的处理都需要时间等待服务器响应，特别是在网络延迟较大的情况下，这种等待时间会显著影响整体的性能。

当使用 Redis pipeline 时，客户端可以一次性发送多个命令到服务器，而无需等待每个命令的响应。服务器接收到这一批命令后，会依次执行这些命令，然后一次性发送所有命令的响应回到客户端。这样做的好处包括：

### 1. 提高效率和性能

由于减少了网络往返次数，pipeline 可以显著提高命令执行的效率，特别是在批量处理命令或在网络延迟较大的环境中。这对于提升大量数据处理的速度非常有帮助。

### 2. 减少网络延迟的影响

在一般的请求 - 响应模型中，每个命令的执行都需要等待网络传输时间。通过 pipeline 技术，多个命令可以在一个网络请求中发送，大大减少了因多次网络往返造成的总体延迟。

### 3. 提高吞吐量

Pipeline 允许客户端和服务器同时处理更多的命令，这直接提高了 Redis 服务器的吞吐量。在高负载情况下，这能够让 Redis 服务器更有效地利用资源，处理更多的请求。

### 4. 适用于批量数据操作

Pipeline 特别适合于批量数据操作场景，比如批量插入、更新或获取数据。它使得这些操作可以更快完成，提升了整体的数据处理能力。

### 注意事项

尽管 Redis pipeline 有许多优势，但在使用时也需要注意几个方面：

- **内存使用**：发送大量命令时，客户端和服务器都需要有足够的内存来缓存这些命令和响应。
- **错误处理**：在 pipeline 操作中，需要适当处理错误，特别是当某些命令执行失败时，如何确保数据的一致性和完整性。
- **命令分组**：在使用 pipeline 时，最好将相关的命令分组发送，以减少对服务器的负载和优化性能。

总的来说，Redis pipeline 是一种有效的性能优化技术，通过减少网络延迟的影响，提高了命令的执行效率和服务器的吞吐量。正确使用 pipeline 可以在许多场景下显著提升 Redis 的性能。
