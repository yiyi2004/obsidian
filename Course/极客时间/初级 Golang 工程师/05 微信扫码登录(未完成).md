- 微信扫码登录基本原理
	- Oauth2 原理
	- 微信扫码登录流程分析
	- 微信登录 API 详解
	- 设计与实现
		- state 用法
- 长短 token
	- 长短 token 基本机制
	- 使用 JWT 实现长短 token
- 退出登录
	- JWT 退出登录
	- 重构已有的 JWT 代码
- 接入配置模块
	- 配置的优先级
	- 本地文件配置与 viper 入门
	- 远程配置
- 接入日志模块
	- zap 框架入门
	- 在 webook 中埋点

---

- state 没有弄明白是用来干嘛的
- 面试题
- 长短 token
- viper 配置中心

实现长短 token 机制

- 引入日志模块，提高软件的可观测性。

## 微信扫码登录基本原理

1. 点击微信登录，跳转到微信页面？问题是跳转过去的 URL 是什么。
2. 微信少吗登录，确认登录。
3. 微信跳转回来。问题是：跳转回来的 URL 是什么？

微信扫码登录其实就是一个 OAuth2 授权过程。

![[Snipaste/Pasted image 20240313215204.png]]

我回去写了一下，使用 Golang 是可以的。笔试真的那么重要嘛？

跳转过去的微信 URL

![[Snipaste/Pasted image 20240313222144.png]]

1. appid
2. rediect_uri
3. response_type 默认是 code
4. scope
5. state 随机数

![[Snipaste/Pasted image 20240313222240.png]]

1. 返回的 code ---> 发起调用 ---> access_token
	1. 传入 appid + secret
2. 微信开放平台提交应用审核通过后
3. secret 应用密钥 AppSecret 审核通过后
4. code
5. grant_type

![[Snipaste/Pasted image 20240313222502.png]]

- 流程要点总结
	- 点击微信登录，跳转到微信页面
	- 微信扫码登录，确认登录，微信跳转回来

构造两个接口

1. 用于构造跳到微信那边的 URL
2. 处理微信跳转回来的请求

- OAuth2WathcerHandler

![[Snipaste/Pasted image 20240314084159.png]]

构造 URL：拼接字符串

![[Snipaste/Pasted image 20240314084259.png]]

1. appid
2. redirect_url
3. state: state := uuid.New()

返回的 code 是临时授权码，调用微信的接口，获取真正的授权码。就是简单的调用微信的 API。

![[Snipaste/Pasted image 20240314084619.png]]

![[Snipaste/Pasted image 20240314084721.png]]

- 从微信中拿回来的字段
	- access_token 短 token
	- expires_in 过期时间
	- refresh_token 长 token

![[Snipaste/Pasted image 20240314084832.png]]

![[Snipaste/Pasted image 20240314084853.png]]

- open_id 产品上的 id
- union_id 公司的 id

![[Snipaste/Pasted image 20240314085006.png]]

 微信扫码登录是注册还是登录

 1. 没有，注册
 2. 如果有，JWT 登录

后端需要使用 state

**state 相关问题没有解决**

准备好自己的工作，不知道你们到底是怎么回事。
